//dna.js v0.1.4 ~~ dnajs.org/license.html
var dna={};dna.util={toCamel:function(a){return(""+a).replace(/\-(.)/g,function(a,b){return b.toUpperCase()})},toCode:function(a){return(""+a).replace(/([A-Z])/g,function(){return"-"+arguments[1].toLowerCase()})},value:function(a,b){return"string"==typeof b&&(b=b.split(".")),null===a||void 0===a||void 0===b?null:1===b.length?a[b[0]]:this.value(a[b[0]],b.slice(1))},call:function(a,b){var c=function(d,e){d?1==e.length?d[e[0]](b):c(d[e[0]],e.slice(1)):dna.core.berserk('Invalid name before "'+e[0]+'" in: '+a)};a&&b.length&&c(window,a.split("."))},apply:function(a,b,c){a.find(b).addBack(b).each(c)}},dna.compile={regexDnaField:/^[\s]*(~~|\{\{).*(~~|\}\})[\s]*$/,regexDnaBasePair:/~~|{{|}}/,regexDnaBasePairs:/~~|\{\{|\}\}/g,isDnaField:function(){var a=$(this)[0].childNodes[0];return a&&a.nodeValue&&a.nodeValue.match(dna.compile.regexDnaField)},fieldElem:function(){$(this).addClass("dna-field").data("dna-field",$.trim($(this).text()).replace(dna.compile.regexDnaBasePairs,"")).empty()},attrElem:function(){var a=[];$.each(this.attributes,function(){3===this.value.split(dna.compile.regexDnaBasePair).length&&a.push(this.name.replace(/^data-dna-attr-/,""),this.value.split(dna.compile.regexDnaBasePair))}),a.length>0&&$(this).addClass("dna-attr").data("dna",a)},getDataField:function(a,b){return $.trim(a.data("dna-"+b).replace(dna.compile.regexDnaBasePairs,""))},addDataToElems:function(a,b){function c(){var a=$(this),c=a.data("dnax")?a.data("dnax"):{};c[b]=dna.compile.getDataField(a,b),a.data("dnax",c).addClass("dna-data")}return a.filter("[data-dna-"+b+"]").each(c)},template:function(a){var b=a.elem.find("*").addBack();b.filter(dna.compile.isDnaField).each(dna.compile.fieldElem),b.each(dna.compile.attrElem),dna.compile.addDataToElems(b,"class"),dna.compile.addDataToElems(b,"require"),dna.compile.addDataToElems(b,"missing"),a.elem.removeClass("dna-template").addClass("dna-clone"),a.compiled=!0}},dna.store={templates:{},stash:function(a,b){var c=$("#"+a);return b||(c.find("[data-dna-array]").addClass("dna-template").each(function(){var b=$(this),c=b.parent(),d=c.data("dnax")?b.data("dnax"):{};d.array=dna.compile.getDataField(b,"array"),c.data("dnax",d).addClass("dna-data"),c.data("dna-array-index",b.index()),b.attr("id",a+"-array-"+d.array)}),c.find(".dna-template").each(dna.store.stashNested)),c.hasClass("dna-template")&&(dna.store.templates[a]={name:a,elem:c,container:c.parent().addClass("dna-contains-"+a).data("dna-contains",a),compiled:!1,clones:0}),c.removeAttr("id").detach(),dna.store.templates[a]},stashNested:function(){dna.store.stash($(this).attr("id"),!0)},getTemplate:function(a){var b=dna.store.templates[a]||dna.store.stash(a);return b||dna.core.berserk("Template not found: "+a),b.compiled||dna.compile.template(b),b}},dna.core={inject:function(a,b,c){dna.util.apply(a,".dna-field",function(){var a=dna.util.value(b,$(this).data("dna-field"));if("string"==typeof a){c.html?$(this).html(a):$(this).text(a)}});var d,e,f,g;dna.util.apply(a,".dna-attr",function(){d=$(this).data("dna");for(var a=0;a<d.length/2;a++)e=d[2*a],f=d[2*a+1],g=[f[0],dna.util.value(b,f[1]),f[2]].join(""),$(this).attr(e,g),"value"===e&&$(this).val(g)})},cloneSubtemplate:function(a,b){var c=a.data("dna-contains");b&&dna.clone(c,b,{holder:a})},processElem:function(a,b){var c=a.data("dnax");c["class"]&&$.each((""+c["class"]).split(","),function(c,d){a.addClass(dna.util.value(b,d))}),c.require&&a.toggle(void 0!==dna.util.value(b,c.require)),c.missing&&a.toggle(void 0===dna.util.value(b,c.missing)),c.array&&dna.core.cloneSubtemplate(a,b[a.data("dnax").array])},replicate:function(a,b,c){function d(){dna.core.processElem($(this),b)}var e=a.elem.clone(!0,!0);a.clones++,dna.core.inject(e,b,c),e.find(".dna-data").addBack(".dna-data").each(d);var f=".dna-contains-"+a.name,g=c.holder?c.holder.find(f).addBack(f):a.container;return c.top?g.prepend(e):g.append(e),c.callback&&c.callback(e,b),c.task&&c.task(e,b),c.fade&&e.hide().fadeIn(),e},unload:function(a,b,c){b.error||dna.api.clone(a,b,c)},berserk:function(a){throw"dna.js error -> "+a}},dna.api={clone:function(a,b,c){var d={fade:!1,top:!1,holder:null,empty:!1,task:null,html:!1,callback:null};$.extend(d,c);var e=dna.store.getTemplate(a);d.empty&&dna.api.empty(a);for(var f=b instanceof Array?b:[b],g=$(),h=0;h<f.length;h++)g=g.add(dna.core.replicate(e,f[h],d));return g},load:function(a,b,c){$.getJSON(b,function(b){dna.core.unload(a,b,c)})},empty:function(a,b){var c={fade:!1};$.extend(c,b);var d=dna.store.getTemplate(a).container.find(".dna-clone");return c.fade?d.fadeOut("normal",function(){$(this).remove()}):d.remove(),d},mutate:function(a,b,c){var d={html:!1};$.extend(d,c),dna.core.inject(a,b,d)},info:function(){return console.log("~~ dns.js v0.1.4 ~~"),console.log("count:",Object.keys(dna.store.templates).length),console.log("names:",Object.keys(dna.store.templates)),console.log("templates:",dna.store.templates),navigator.appVersion}},dna.clone=dna.api.clone,dna.load=dna.api.load,dna.empty=dna.api.empty,dna.mutate=dna.api.mutate,dna.info=dna.api.info;